# Web IDE 개발 전체 흐름

웹 기반 IDE를 개발하려고 한다.
목표는 사용자가 브라우저에서 Java, JavaScript, Python 소스코드를 작성하고 실행하면,
서버에서 Docker 컨테이너를 이용해 코드를 안전하게 실행하고,
실행 결과(stdout / stderr)를 실제 터미널처럼 실시간으로 브라우저에 스트리밍해주는 것이다.

## 1. 기본 실행 구조

- 서버는 Docker를 사용하여 코드 실행 환경을 완전히 격리한다.
- 언어별로 Docker 이미지를 미리 빌드해 둔다.
  - 예: java-runner, python-runner, node-runner
- 각 이미지는 해당 언어 런타임과 실행 명령만 포함하며, 사용자 코드는 포함하지 않는다.
- 사용자가 실행 버튼을 누를 때마다:
  - 선택한 언어의 Docker 이미지로 새 컨테이너를 생성
  - 컨테이너 안에서 컴파일 및 실행
  - 실행이 끝나면 컨테이너는 즉시 삭제한다.

## 2. 언어별 실행 방식

- Python / JavaScript
  - 컴파일 과정 없이 컨테이너 내부에서 바로 실행
- Java
  - 컨테이너 내부에서 javac로 컴파일 후 java로 실행
- 컴파일과 실행은 모두 Docker 컨테이너 내부에서 수행한다.
- 서버 호스트에서는 사용자 코드를 절대 직접 실행하지 않는다.

## 3. 코드 실행 요청 흐름

- 사용자는 브라우저에서 언어를 선택하고 코드를 작성한 뒤 실행 요청을 보낸다.
- 서버는 실행 요청마다 고유한 실행 세션 ID를 생성한다.
- 해당 세션 ID를 기준으로 임시 디렉토리를 생성하고, 사용자 소스코드를 파일로 저장한다.
- 서버는 docker run 명령을 통해 컨테이너를 실행한다.
  - `--rm` 옵션으로 종료 시 자동 삭제
  - `-v` 옵션으로 임시 디렉토리를 컨테이너에 마운트
  - CPU, 메모리, 프로세스 수, 네트워크 제한 적용
- 컨테이너는 마운트된 소스코드를 실행한다.

## 4. 실시간 출력 처리 (핵심)

- 서버는 docker run -i 방식으로 컨테이너를 실행해 stdin/stdout 스트림을 유지한다.
- 서버 프로세스는 컨테이너의 stdout, stderr를 스트림으로 실시간 읽는다.
- 읽은 출력은 즉시 WebSocket(또는 SSE)을 통해 브라우저로 전송한다.
- 브라우저는 이를 터미널 UI처럼 한 줄씩 출력한다.
- Python은 -u 옵션을 사용하여 출력 버퍼링을 방지한다.

## 5. 사용자 입력(stdin) 처리

- WebSocket을 통해 사용자가 입력한 값을 서버로 전달한다.
- 서버는 해당 실행 세션에 매핑된 Docker 프로세스의 stdin에 입력을 전달한다.
- 이를 통해 Scanner, input() 등 표준 입력을 사용하는 프로그램도 정상 실행되도록 한다.

## 6. 실행 중단 및 타임아웃 처리

- 실행 세션마다 프로세스(또는 컨테이너 ID)를 서버에서 관리한다.
- 사용자가 중단 버튼을 누르거나 실행 시간이 제한을 초과하면:
  - Docker 컨테이너를 강제 종료한다.
  - 실행 상태를 STOPPED 또는 TIMEOUT으로 변경한다.
  - 종료 후 리소스 및 임시 파일을 정리한다.

## 7. 동시 사용자 처리

- 같은 언어를 사용하는 여러 사용자가 동시에 실행 요청을 보내도:
  - Docker 이미지는 공유
  - 컨테이너는 사용자별로 각각 독립 생성
  - 사용자 간 파일 시스템, 프로세스, 메모리는 완전히 분리된다.
- 서버는 동시에 실행 가능한 컨테이너 수를 제한하고, 초과 요청은 큐잉 처리한다.

## 8. 보안 및 안정성

- 모든 컨테이너 실행 시 다음 제한을 적용한다:
  - CPU / 메모리 제한
  - 프로세스 수 제한
  - 네트워크 차단
  - 읽기 전용 파일 시스템
- 컨테이너 외부(호스트 서버) 접근은 불가능해야 한다.
- 악성 코드 또는 무한 루프로부터 서버를 보호한다.

## 9. 상태 관리

각 실행은 다음 상태 중 하나를 가진다.

- READY
- RUNNING
- FINISHED
- STOPPED
- TIMEOUT

상태 변화는 실시간으로 클라이언트에 전달한다.

## 10. 최종 목표

- 사용자는 실제 로컬 IDE에서 실행하는 것처럼:
  - 실시간 출력
  - 입력 가능
  - 중단 가능
- 서버는 Docker 기반 격리로 안전하게 코드 실행을 제공한다.
- 이 구조는 확장 가능한 Web IDE 아키텍처의 기본이 된다.
